--- a/kernel/sched_fair.c	2011-08-02 16:04:22.000000000 -0400
+++ b/kernel/sched_fair.c	2011-09-11 11:30:23.000000000 -0400
@@ -3253,9 +3253,10 @@
 		cpu_rq(cpu)->in_nohz_recently = 1;
 
 		if (!cpu_active(cpu)) {
-			if (atomic_read(&nohz.load_balancer) != cpu)
+                      if (atomic_read(&nohz.load_balancer) != cpu) {
+				cpumask_clear_cpu(cpu, nohz.cpu_mask);
 				return 0;
-
+			}
 			/*
 			 * If we are going offline and still the leader,
 			 * give up!
@@ -3263,6 +3264,8 @@
 			if (atomic_cmpxchg(&nohz.load_balancer, cpu, -1) != cpu)
 				BUG();
 
+			cpumask_clear_cpu(cpu, nohz.cpu_mask);
+
 			return 0;
 		}
 
